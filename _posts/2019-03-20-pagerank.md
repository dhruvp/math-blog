---
layout: post
title: PageRank
comments: false

---

{% katexmm %}

Welcome back! Last time we [derived Eigenvectors]({% post_url 2019-02-25-eigenvectors %}) and saw how useful they are in analyzing matrices we need to apply again and again. In this post, we're going to dive into one of the most famous applications of Eigenvectors - the original PageRank algorithm that allowed Google to create the world's best search engine!

By the end of this post, you'll:

1. Feel like you could have come up with PageRank yourself.
2. Understand how eigenvectors are central to PageRank.
3. See how central eigenvectors are to dynamic processes in general.

We're going to build out a hypothetical scenario and use that to motivate and derive PageRank. Ok let's dive in!

### Making Friends

You just moved to a new city and you’re trying to make some new friends. You’re trying to figure out which new friends to hang out with in your free time. Trouble is you’re super busy and have very little free time! So you need to rank all these potential friends to prioritize which ones to chill with.

<p class='image-block'>
<img src='https://images2.minutemediacdn.com/image/upload/c_fill,w_912,h_516,f_auto,q_auto,g_auto/shape/cover/entertainment/5b2fefb9fae96f45b7000002.jpeg' />

This could be you!
</p>

In a moment of clarity you realize the following:

1. Friends you’re close with are probably going to hang out with people you’d like.
2. A person a lot of people call their friend is probably someone you want to be friends with.


You decide to use these two insights to create a scheme you in a moment of originality call **FriendRank**.

FriendRank gives a potential friend a score (FriendScore) based on:

<div class='highlight-block'>
<ol>
    <li>
        How many people are friends with this person weighted by
    </li>
    <li>
        How close you are to the people who are friends with them.
    </li>
</ol>
</div>

<div class='image-block'>
    <img src='/public/images/pagerank/abstract_friends.jpg' />
    In the above picture, how close you are to a person is shown by the size of the circle. To find your friend score for potential friend $F$, you just add up how close you are to $A$, $C$, and $D$.
</div>

Let’s write this down as a formula. Let’s say the strength of the friendship between you and some person $p$ is $FS(p)$. Let $Friends(p)$ be the set of friends of $p$.

<div class='highlight-block'>
The FS (FriendScore) for a potential friend Fred is:

$$ FS(Fred) = \sum_{p \in Friends(Fred)} FS(p) $$

</div>

#### Calculating Our First Friend Score

Let’s work through an example. Say you have 4 potential friends:

1. Jimmy (closeness score - 5)
2. Maya (closeness score - 9)
3. Lisa (closeness score - 8)
4. Fred (?)


In this world, you’re really close to Maya (with a score of 9) and Lisa (8) but only kinda close to Jimmy (5). 

Only Jimmy and Maya are both friends with Fred.

Graphically, this is:

<div class='image-block'>
    <img src='/public/images/pagerank/fred_friends.jpg' />
    Only Jimmy and Maya claim to be friends with Fred. Lisa seems to be <a href='https://www.youtube.com/watch?v=ptmM-m7Cl8U'>tearing him apart</a>.
</div>

So:
$$ FS(Fred) = FS(Jimmy) + FS(Maya)$$
$$FS(Fred) = 8 + 9 = 17$$

#### Accounting For People who are Friends With Everyone

Not such a crazy idea right? You start this process and you realize one thing. Your really close friend Maya calims to  be friends with EVERYONE. You start wondering, "Hmm maybe I need to downweight Maya’s opinion because she doesn’t really seem to be that picky”.

This is easy - we just divide Maya’s weighting score by how many people she claims to be friends with. That way if Maya claims 100 friends, his weighting for each friend is divided by 100. So our formula is now:

<div class='highlight-block'>
$$ FS(Fred) = \sum_{p \in Friends(Fred)} FS(p) \cdot \frac{1}{NumFriends(p)} $$
</div>

Going back to our example, our score becomes:
$$FS(Fred) = \frac{FS(Jimmy)}{2} + \frac{FS(Maya)}{4}$$
$$FS(Fred) = 4 + \frac{9}{4} = 6.25$$


Awesome!

Let’s now simplify this formula a little.
1. Let’s call the set of all friends $F$.
2. Let $IsFriends(p, Fred)$ be $1$ if $p$ and $Fred$ are friends and $0$ otherwise. Then, the above formula is equivalent to:

$$FS(Fred) = \sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Fred)}{NumFriends(p)}$$

All the people who aren’t friends with Fred just get $0$ terms which gives us the same thing.


#### Time For Action!

Ok this is looking great! You decide to go ahead and implement this scheme with your friends Bobby, Lauren, Daniel, Rony, and Saba. You start by asking all your friends to write down who they’re friends with! So you send them all the following email:

<blockquote>
    <div>
        My dearest "friends",
    </div>
    <br/>
    <div>
    I’m trying to rank you and all my other potential friends and need your help to do so. Below is a list of people. Please put a 1 next to their name if you call them your friend.
    </div>
    <div>
        <br />
        <table style='text-align: center;'>
            <tr>
                <th>Person</th>
                <th>Friends?</th>
            </tr>
            <tr>
                <td>Bobby</td>
                <td>___</td>
            </tr>
            <tr>
                <td>Lauren</td>
                <td>___</td>
            </tr>
            <tr>
                <td>Daniel</td>
                <td>___</td>
            </tr>
            <tr>
                <td>Rony</td>
                <td>___</td>
            </tr>
            <tr>
                <td>Saba</td>
                <td>___</td>
            </tr>
        </table>
    </div>
    <br/>
    <div>
        Yours truly,
    </div>
    <div>
        Parry Lage
    </div>
    <br />
    <div>
        P.S. Just because I'm sending you this email doesn't mean we're friends.
    </div>
</blockquote>

So Saba sends you something like this:

<table style='text-align: center;'>
    <tr>
        <th>Person</th>
        <th>IsFriends</th>
    </tr>
    <tr>
        <td>Bobby</td>
        <td>$1$</td>
    </tr>
    <tr>
        <td>Lauren</td>
        <td>$1$</td>
    </tr>
    <tr>
        <td>Daniel</td>
        <td>$0$</td>
    </tr>
    <tr>
        <td>Rony</td>
        <td>$0$</td>
    </tr>
    <tr>
        <td>Saba</td>
        <td>$0$</td>
    </tr>
</table>


Looking good so far! You then remember you need to downweight Saba’s score by how many friends she claims to have. She’s claiming 2 friends here so we divide by 2 giving us:

<table style='text-align: center;'>
    <tr>
        <th>Person</th>
        <th>IsFriends</th>
    </tr>
    <tr>
        <td>Bobby</td>
        <td>$\frac{1}{2}$</td>
    </tr>
    <tr>
        <td>Lauren</td>
        <td>$\frac{1}{2}$</td>
    </tr>
    <tr>
        <td>Daniel</td>
        <td>$0$</td>
    </tr>
    <tr>
        <td>Rony</td>
        <td>$0$</td>
    </tr>
    <tr>
        <td>Saba</td>
        <td>$0$</td>
    </tr>
</table>

Sweet.

You now decide to organize all your friends responses into a little table so that it’s easy to see. Each column of the table is a different friend. It looks like this:

<table style='text-align: center;'>
    <tbody>
        <tr>
            <th></th>
            <th>Bobby</th>
            <th>Lauren</th>
            <th>Daniel</th>
            <th>Rony</th>
            <th>Saba</th>
        </tr>
        <tr>
            <td><strong>Bobby</strong></td>
            <td>$0$</td>
            <td>$1$</td>
            <td>$\frac{1}{3}$</td>
            <td>$0$</td>
            <td>$\frac{1}{2}$</td>
        </tr>
        <tr>
            <td><strong>Lauren</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$\frac{1}{3}$</td>
            <td>$0$</td>
            <td>$\frac{1}{2}$</td>
        </tr>
        <tr>
            <td><strong>Daniel</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
        </tr>
        <tr>
            <td><strong>Rony</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
        </tr>
        <tr>
            <td><strong>Saba</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$\frac{1}{3}$</td>
            <td>$1$</td>
            <td>$0$</td>
        </tr>
    </tbody>
</table>

This table is just a matrix, which we'll call $A$. The element $i,j$ in the matrix is

$$A[i,j] = \frac{IsFriends(j, i)}{NumFriends(j)}$$


You then realize you have to take the quiz yourself! There are some people you know better than others so this is really a guess for what your final FriendScore is for each of them. You write down the following and call it $FS_{0}$ - your initial FriendScore:

<table style='text-align: center;'>
    <tr>
        <th>Person</th>
        <th>IsFriends</th>
    </tr>
    <tr>
        <td>Bobby</td>
        <td>$\frac{1}{5}$</td>
    </tr>
    <tr>
        <td>Lauren</td>
        <td>$\frac{1}{5}$</td>
    </tr>
    <tr>
        <td>Daniel</td>
        <td>$\frac{1}{5}$</td>
    </tr>
    <tr>
        <td>Rony</td>
        <td>$\frac{1}{5}$</td>
    </tr>
    <tr>
        <td>Saba</td>
        <td>$\frac{1}{5}$</td>
    </tr>
</table>

#### Combining Everyone's Opinion

<div class='image-block'>
    <img src='https://i.guim.co.uk/img/static/sys-images/Arts/Arts_/Pictures/2012/12/19/1355935545255/Russell-Crowe-in-A-Beauti-009.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=2d44f3a60cd54815a5658a8023be577d'/>
    Omg this is a lot more work than I expected.
</div>

Ok we now have the following:

1. $A$ - a Matrix who's elements are $A[i,j] = \frac{IsFriends(j, i)}{NumFriends(j)}$.
2. $FS_0$ - An initial guess of everyone's FriendScore.


Ok so now that we know who's friends with who, we can figure out who's really likely to be our friend. We'd like to come up with a new FriendScore $FS_{1}$ based on this information.

How do we do that?

Recall from earlier how we formula for Fred's FriendScore:

>Let’s now simplify this formula a little.
>1. Let’s call the set of all friends $F$.
>2. Let $IsFriends(p, Fred)$ be $1$ if $p$ and $Fred$ are friends and $0$ otherwise. Then, the above formula is equivalent to:
>
>$$FS(Fred) = \sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Fred)}{NumFriends(p)}$$


So similarly, we want to update our rankings, $FS_{1}$ for our friends to be:

<table style='text-align: center;'>
    <tr>
        <th>Person</th>
        <th>FriendScore</th>
    </tr>
    <tr>
        <td>Bobby</td>
        <td>$$\sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Bobby)}{NumFriends(p)}$$</td>
    </tr>
    <tr>
        <td>Lauren</td>
        <td>$$\sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Lauren)}{NumFriends(p)}$$</td>
    </tr>
    <tr>
        <td>Daniel</td>
        <td>$$\sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Daniel)}{NumFriends(p)}$$</td>
    </tr>
    <tr>
        <td>Rony</td>
        <td>$$\sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Rony)}{NumFriends(p)}$$</td>
    </tr>
    <tr>
        <td>Saba</td>
        <td>$$\sum_{p \in F} FS(p) \cdot \frac{IsFriends(p, Saba)}{NumFriends(p)}$$</td>
    </tr>
</table>

Let's shorten our notation:

1. Let $IF$ be $IsFriends$
2. Let $NF$ be $NumFriends$


Then Bobby’s ideal new ranking is:

$$\sum_{p \in F} FS(p) \cdot \frac{IF(p, Bobby)}{NF(p)}$$

This looks an awful lot like this dot product (go ahead and compute it):

<div style='font-size: 17px;'>
$$\begin{bmatrix} \frac{IF(Bobby, Bobby)}{NF(Bobby)} & \frac{IF(Lauren, Bobby)}{NF(Lauren)} & \frac{IF(Daniel, Bobby)}{NF(Daniel)} & \frac{IF(Rony, Bobby)}{NF(Rony)} & \frac{IF(Saba, Bobby)}{NF(Saba)} \end{bmatrix} \cdot \begin{bmatrix} FS(Bobby) \\ FS(Lauren) \\ FS(Daniel) \\ FS(Rony) \\ FS(Saba) \end{bmatrix}$$
</div>

Let's take a look at the matrix $A$ again:

<table style='text-align: center;'>
    <tbody>
        <tr>
            <th></th>
            <th>Bobby</th>
            <th>Lauren</th>
            <th>Daniel</th>
            <th>Rony</th>
            <th>Saba</th>
        </tr>
        <tr>
            <td><strong>Bobby</strong></td>
            <td>$0$</td>
            <td>$1$</td>
            <td>$\frac{1}{3}$</td>
            <td>$0$</td>
            <td>$\frac{1}{2}$</td>
        </tr>
        <tr>
            <td><strong>Lauren</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$\frac{1}{3}$</td>
            <td>$0$</td>
            <td>$\frac{1}{2}$</td>
        </tr>
        <tr>
            <td><strong>Daniel</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
        </tr>
        <tr>
            <td><strong>Rony</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
            <td>$0$</td>
        </tr>
        <tr>
            <td><strong>Saba</strong></td>
            <td>$\frac{1}{4}$</td>
            <td>$0$</td>
            <td>$\frac{1}{3}$</td>
            <td>$1$</td>
            <td>$0$</td>
        </tr>
    </tbody>
</table>

<div class='highlight-block'>
    Notice the following:
    <div style='font-size: 17px;'>
        <ol>
            <li>
            The first row of $A$ is exactly:
            $$\begin{bmatrix} \frac{IF(Bobby, Bobby)}{NF(Bobby)} & \frac{IF(Lauren, Bobby)}{NF(Lauren)} & \frac{IF(Daniel, Bobby)}{NF(Daniel)} & \frac{IF(Rony, Bobby)}{NF(Rony)} & \frac{IF(Saba, Bobby)}{NF(Saba)} \end{bmatrix}$$
            </li>
            <li>
            Your ranking list, $FS_{0}$, is exactly the second vector $\begin{bmatrix} FS(Bobby) \\ FS(Lauren) \\ FS(Daniel) \\ FS(Rony) \\ FS(Saba) \end{bmatrix}$
            </li>
        </ol>
    </div>
</div>


So if we just take your original FriendScore guess, $FS_{0}$ and multiply $A \cdot FS_{0}$ we get the $FS(Bobby)$ in the first row of the resulting vector.

$$ A \cdot FS_{0} = \begin{bmatrix} FS(Bobby) \\ - \\ - \\ - \\ - \end{bmatrix} $$

More generally, you'll find that the second row of this vector is exactly $FS(Lauren)$ etc, giving us:

$$ A \cdot FS_{0} = \begin{bmatrix} FS(Bobby) \\ FS(Lauren) \\ FS(Daniel) \\ FS(Rony) \\ FS(Saba) \end{bmatrix} $$


<div class='highlight-block'>

So, if we call $FS_{1}$ the result of folding in the results of $A$ into your initial predictions, we get:

$$ A \cdot FS_{0} = FS_{1} $$

</div>

#### When Do We Stop?

Ok so we now have a super quick way of finding our friend scores. Just take our current guess, which we’ll call $FS_i$, multiply it by $A$, and obtain $FS_{i+1}$:

$$FS_{i+1} = A \cdot FS_{i}$$

Everytime we compute $A \cdot FS_{i}$, we are updating our guess of our Friend Score with the rest of our friends opinions.


When do we stop this process? We stop when FS_{i+1} stops changing:

$$FS_{i+1} = FS_{i} = FS^*$$

<div class='highlight-block'>

At this point, which we call $FS^*$,

$$A \cdot FS^* = FS^*$$

</div>

Does this look like $Ax = \lambda x$? Yes! 
This is exactly the formula for an **eigenvector**!

So the final solution $FS^*$, is an eigenvector of $A$!


#### Seeing This Visually

How does $FS_i$ move to $FS^*$?
In many ways, the matrix $A$ pulls $FS_i$ towards its eigenvector $FS^*$. There’s an awesome visualization of this [here](http://setosa.io/ev/eigenvectors-and-eigenvalues/) by setosa.io that I highly recommend you check out. Here’s an extract directly from their writeup.

<div class='image-block'>
    <img src='/public/images/pagerank/eigen_process.png'/>
    As you keep applying $A$ on $v$, $v$ gets pulled towards the eigenvector $s_1$.
</div>

Here's what's happening:

1. Through multiplication, $A$ pulls $FS_i$ towards its eigenvector $FS*$.
2. At the end of the process, $A \cdot FS^*$ just remains on $FS^*$ and the process converges.

<div class='image-block'>
    <img src='https://gifimage.net/wp-content/uploads/2018/04/rey-lightsaber-gif-5.gif'/>
The matrix $A$ (Rey?) pulls its inputs (the lightsaber?!) towards its eigenvectors (her hand?!). Does this analogy even work?
</div>

<div class='highlight-block'>
Therefore, the solution to FriendRank is to just find the eigenvector of $A$.
</div>

#### From Friends to Pages

You’ve probably guessed at this point that you can switch the word friends to pages in the above and get PageRank! In the world of webpages:

1. One webpage claims to be “friends” with another if it links out to the webpage.

2. Google finds out who’s friends with who (our initial survey) by just crawling the web and finding out who links to who.

3. The number of "friends" a webpage claims to have is just the number of links present on the webpage.

Putting this together gives us a way of ranking all webpages on the internet for relevance!

What's cool to me is that PageRank takes a really intuitive real-world idea around how we rank people and applies it to the more abstract yet equally tangible problem of ranking webpages.

A quick aside, notice that PageRank is actually a next level pun - PageRank was written by Larry Page about ranking webpages - well done Larry.

### Conclusion

So we’ve seen that eigenvectors are at the heart of one of the most important algorithms of all time! More generally, whenever you see a linear function being applied again and again and again (Like $A$), you are without a doubt going to be looking for the eigenvectors of that linear function/matrix. The eigenvectors will tell you where that process send its inputs in the end!

I hope you enjoyed this unique and powerful application of eigenvectors. In the next post we're going to switch back to theory and learn about determinants and why they exist.

{% endkatexmm %}
